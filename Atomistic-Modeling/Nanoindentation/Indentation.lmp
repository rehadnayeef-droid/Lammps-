#Created by Rehad Nayeef on 21/08/2025 at 10.14 pm 
# Script is under developing stage
# Advanced Indentation Simulation with Multiple Control Methods

clear
# ---------- Setup Variables ---------------------
variable etol equal 1.0e-25
variable ftol equal 1.0e-25
variable maxiter equal 1000
variable maxeval equal 10000 

# ---------------- Initialization ----------------
units           metal
dimension       3
boundary        p s p
atom_style      atomic

# ---------------- Structure Input ----------------
# Read pre-built alloy structure
read_data       alloy.lmp

# ---------------- Groups Definition ----------------
region 1 block INF INF 88 INF INF INF units box
region 2 block INF INF INF 1 INF INF units box
region	3 block  INF INF INF 10 INF INF   units box
group	lower region 3 
group top region 1
group bottom region 2
group inner subtract all bottom top

#delete_atoms group step
delete_atoms group top
delete_atoms group bottom
# ---------------- Potential (MEAM for Al-Cu-Mg) ----------------
pair_style      meam
pair_coeff      * * library.meam Al Si Mg Cu Fe alloy.meam Al Mg Cu
neighbor 2.0 bin
neigh_modify delay 10 check yes

# ---------------- Computes ----------------
compute new inner temp
compute csym all centro/atom fcc
compute eng all pe/atom 

# ---------- Run Minimization ----------------------------
reset_timestep 0
thermo 100
min_style cg
minimize ${etol} ${ftol} ${maxiter} ${maxeval}

# ---------- totally fix all boundaries ---------------------
fix		7 lower setforce 0.0 0.0 0.0
velocity lower set 0 0 0 


# ---------- initial velocities ---------------------------
reset_timestep 0
timestep        0.001
velocity inner  create 10.00 4882748 temp new
fix            4 all nvt temp 10.0 10.0 0.01 drag 1.0

## ---------- relaxation --------------------------------
thermo          100
thermo_style    custom step temp
thermo_modify temp new
run             5000

# ---------- indentation -------------------------------------------
variable xmid equal lx/2
variable zmid equal lz/2
variable y equal "110.1-0.1*step*dt"
fix 5 all indent 100.0 sphere ${xmid} v_y ${zmid} 20 units box
variable displacement equal "(110.1 - v_y)"

# ---------- Run with indenter ------------------------------------------
reset_timestep	0
timestep 0.001
thermo 100
thermo_style custom step temp f_5[2] v_displacement
thermo_modify temp new
# ---------------- Thermo & Output ----------------
thermo          100
dump            myDump all atom 100 dump.atom
run 300000
