# Functionally Graded Alloy (Ni-Al) along z
units           metal
atom_style      atomic
boundary        p p p

# --- Box & lattice ---
variable        a equal  3.52             # fcc lattice param (approx Ni)
lattice         fcc ${a}
region          box block 0 120 0 30 0 36    units box
create_box      2 box                        # 2 types: 1=Ni, 2=Al
create_atoms    1 box                         # fill with type 1 (Ni)

# --- Potential (ships with LAMMPS distro examples) ---
pair_style     meam 
pair_coeff      * * library.meam Ni Ti Al NiAlTi.meam Ni Al

# --- Neighbor/thermo ---
neighbor        2.0 bin
neigh_modify    delay 0 every 1 check yes
thermo          200
thermo_style    custom step temp pe ke etotal press lx ly lz

# --- Build a smooth composition gradient x_Zn(z) ---
# Use a power-law: x_Al(z) = x0 + (x1 - x0)*(1/2 + z/H)^n
# Tweak x0, x1, n as you like.
variable        x0 equal 0      # bottom Al fraction
variable        x1 equal 1      # top Al fraction
variable        n  equal 5    # curvature of the grade
variable        H  equal lz        # box height (z-span)

# Number of z-bins to realize the gradient
variable        nbins equal 36    # ~1 bin per box "lattice" unit here
variable        dz equal ${H}/${nbins}

# For each bin, convert a fraction of atoms to type 2 (Zn) to hit target x(z)
# We operate on atoms currently of type 1 within each bin.
variable        seed equal 12345

label           makebins
variable        i loop ${nbins}
  variable zlo equal (${i}-1)*${dz}
  variable zhi equal (${i})*${dz}
  variable zm  equal 0.5*(${zlo}+${zhi})

  # target Zn fraction at bin midpoint
  variable zfrac equal ${zm}/${H}
  variable xNi   equal ${x0}+(${x1}-${x0})*(${zfrac}^${n})

  # figure out how many atoms are in this bin and how many should be Ni
  region   slab${i} block INF INF INF INF ${zlo} ${zhi} units box
  group    gbin_${i} region slab${i}

  # Convert a fraction of type-1 atoms in this bin to type-2 (randomly)
  # 'set ... type/fraction' chooses a random subset equal to the requested fraction.
  # We can't directly give "fraction among all atoms" here; instead we apply the target
  # xNi as the fraction within this bin.
  set      group gbin_${i} type/fraction 2 ${xNi} ${seed}

  # cleanup
  group    gbin_${i} delete
next i
jump SELF makebins

# --- Quick energy minimization ---
min_style       cg
minimize        1e-10 1e-10 10000 100000

# --- Anneal to smooth local disorder and relax stresses ---
velocity        all create 1200 987654 mom yes rot yes dist gaussian
fix             1 all npt temp 1200 1200 0.1 iso 0 0 1.0
timestep        0.001
run             1000

# cool to 300 K
fix             1 all npt temp 1200 300 0.1 iso 0 0 1.0
run             1000
unfix           1

# --- Verify the composition gradient (profile vs z) ---
compute         cz all chunk/atom bin/1d z lower ${dz} units box
fix             prof all ave/chunk 200 5 1000 cz density/number file comp_profile.txt
# Columns: bin-ID, z-coordinate (bin center), number density, frac(type1=Mg), frac(type2=Zn)

# sample a bit at 300 K (NVT) to get stable averages
fix             nvt all nvt temp 300 300 0.1
run             2000
unfix           nvt
unfix           prof

# Save the relaxed FGM model for later tensile simulation
write_data alloy.lmp 
